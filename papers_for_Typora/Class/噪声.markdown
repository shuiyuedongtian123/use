# 噪声

## 第5章

### 5.1

<img src="./assets/image-20230619000821690.png" alt="image-20230619000821690" style="zoom:50%;" />

噪声重要性：SNR 反应电路所能够处理的最小信号，信号的功率正比与电源的平方，噪声的功率正比于KT/C, 从而定义SNR随着工艺的进步，芯片的共用电压是不断的下降的，即VDD下降，要保证SNR不变，要求C不断变大。增加电容会增加功耗，因为amp运放是驱动电容的，如果速度，带宽不变，电量增加。Analog: speed 2倍，整体功耗变大4倍。

<img src="./assets/image-20230619002014693.png" alt="image-20230619002014693" style="zoom:50%;" />

只探讨热噪声，不是数字电路到模拟电路中间的干扰，clock不断动作，有一些耦合。

<img src="./assets/image-20230619002305499.png" alt="image-20230619002305499" style="zoom:50%;" />

任何电路都是存在噪声的，对运放来讲，输入端接地，理想电路中，输入为0，输出为0，但是实际如上。噪声是一个随机的，不能说在某个时间点，其幅值Amp是多少，需要用数据统计。用噪声的平均值或者功谱来描述。

<img src="./assets/image-20230619002638232.png" alt="image-20230619002638232" style="zoom:50%;" />

探讨电阻的热噪声：由布朗运动引起。噪声的功率的求法：$k_B$:布尔曼常数，T：温度，$\triangle f$：所要求的噪声功耗频率段，噪声能量：$k_BT$

<img src="./assets/image-20230619011132044.png" alt="image-20230619011132044" style="zoom: 25%;" />

为了建立电阻的噪声模型，串联的电压源和电阻串联，电压源等价为电阻的噪声电压。正负号非极性，是随机的形式。因为串联，外面的负载R和内部的R两个电阻R的功率是一样的。里面R的功率是之前定义的$k_BT\triangle f$，外面的功率R, 在两个R之间的节点电压为V/2， 外面的R的功率是 $(V_n/2)^2/R$, 两者相等，构建等式，可以推出上述。外面的电阻是噪声匹配电阻，这个电阻和噪声电阻串联，可以在外面的电阻上，两个电阻一样的时候，得到最大的功率。后续介绍，如何减少电路中的噪声。

<img src="./assets/image-20230619011521741.png" alt="image-20230619011521741" style="zoom:50%;" />

得到了噪声的电压源，也可以变成噪声的电流源，除以R^2就可以。只有消耗功率的元件才会产生噪声。当R=1K, T=300,$\triangle f=1Hz$,给了个例子。

<img src="./assets/image-20230619011919967.png" alt="image-20230619011919967" style="zoom:50%;" />

只有消耗功率的源件会尝试热噪声，电组有热噪声，电容没有热噪声，电容是储存能量，电容，电感都是不产生热噪声。

<img src="./assets/image-20230619013504706.png" alt="image-20230619013504706" style="zoom: 33%;" />

对于噪声来说，瞬时电压是可以相加的，两个电阻串联，每一时刻噪声电压是可以相加的。功率谱密度是可以相加的，如上。方均更是不能相加的RMS, 即$V_n$.

<img src="./assets/image-20230619015548161.png" alt="image-20230619015548161" style="zoom: 33%;" />

电容，电感，变压器没有噪声，上述左图，电容器虽然没有噪声，但是起到了滤波器的作用。若要求C两端的噪声电压，横坐标频率，纵坐标谱值。通过不同频率点求和，得到上面的公式。没理解。

<img src="./assets/image-20230619021012457.png" alt="image-20230619021012457" style="zoom: 33%;" />

介绍新的噪声，二极管噪声：散粒噪声。区别于热噪声依赖温度，二极管噪声与温度无关，与流过的电流I相关。q电子电荷量，i电流，$\triangle f$带宽。二极管，因为跃迁能量带，电子跃迁产生，电子电荷量越大，二极管噪声越大。

### 5.2

<img src="./assets/image-20230619021628748.png" alt="image-20230619021628748" style="zoom: 33%;" />

探究两个噪声是否有联系。给了一个黑盒，假设是一个电阻，公式如上，带入mos管的跨导公式，得到图上公式。二极管噪声电流只有一个方向，电阻可以有2个方向。

<img src="./assets/image-20230619022319384.png" alt="image-20230619022319384" style="zoom: 33%;" />

再介绍一种截停噪声BJT噪声，以上不存在理由是，非物理存在，小信号模型图里面等效出来的电阻，故不产生热噪声。

<img src="./assets/image-20230619023129649.png" alt="image-20230619023129649" style="zoom:50%;" />

Mos管可以工作在不同区域，饱和区，线性区。工作在线性区的mos管可以看做一个电阻。得到mos管的跨导，将它带入原本的电阻公式。

<img src="./assets/image-20230619023452015.png" alt="image-20230619023452015" style="zoom:50%;" />

饱和区的时候，沟道电阻不均匀，可能存在越靠近源端，电阻越小，越靠近漏端，电阻越大。若将沟道电阻划分N等分，求其等效电阻，就可以用之前的公式了。对于Mos管来说，跨导越大，噪声电流越大。上述都是长沟器件而言的。

<img src="./assets/image-20230619024234638.png" alt="image-20230619024234638" style="zoom: 33%;" />

对于短沟器件，上面第一条等式不成立，引入一个Alpha 参数，一般等于0.5。对于mos管的gate来说，也有寄生的串联电阻，也会产生noise，可以忽略。

<img src="./assets/image-20230619024502242.png" alt="image-20230619024502242" style="zoom: 33%;" />

Mos工作在亚阈值区，是一个横向的NPN结构，截型长项管，以散粒噪声为主导的。

<img src="./assets/image-20230619024959817.png" alt="image-20230619024959817" style="zoom:50%;" />

是一个MOs管小信号模型，引入一个噪声电流，右边。

<img src="./assets/image-20230619030522272.png" alt="image-20230619030522272" style="zoom: 33%;" />

Mos管画氧化层，上gate, 最有源和删，氧化层有缺陷，会作为陷阱存在，电子会跃迁到氧化层陷阱之中，存在氧化层的电子会改变Mos管的阈值电压$V_{th}$。电子跃迁越多，$V_{th}$改变越大，产生的噪声电流越大。即等待的时间越长，频率越小，噪声电流越大。即电流是正比于T，正比于1/f的。强烈依赖于工艺，K值不断变化，Cox栅氧化层电容，tox越小，即栅氧化层厚度越小，陷阱数量少，电流小，tox正比于电流。g_m正比于1/L，正比于电流。某一频率范围内积分，得到总的噪声电流。应用在频率低，精确度要求高的地方。

<img src="./assets/image-20230619031001318.png" alt="image-20230619031001318" style="zoom: 33%;" />

转角频率：一个mos管的噪声电流，一部分因为热，一部分是因为1/f。频率-噪声电流，热噪声+1/f， 判断谁主导，定义了相交点为转角。随着L变小，fc噪声越重要。

<img src="./assets/image-20230619031730224.png" alt="image-20230619031730224" style="zoom: 33%;" />

给出手算噪声的方法：电路等价小信号模型，画一个mos, 输出端负载电容，画出小信号模型，左边gmVin, 中间噪声电流，配上负载电流，噪声与输入无关，左边电流源为0，计算输出端的输出电压，在关心评率段上对传递函数进行积分。

<img src="./assets/image-20230619032240780.png" alt="image-20230619032240780" style="zoom: 67%;" />



## 6.1噪声与实例

<img src="./assets/image-20230619090651965.png" alt="image-20230619090651965" style="zoom:50%;" />

正弦波输入，闭合时，C累积电荷，采样保持电路，R_SW非串联的电路，是开关的寄生电阻，不可避免存在，有热噪声存在，电容C上得到（保持）的电压信号和输入电压是有些偏离的。开关断开，本来想电容C保持输入电压的某个值V_1，但是直接保持了另外一个值V_2。为分析噪声电压，首先vin设置为0，电阻有噪声电压，开关关闭，求输出点的噪声电压。因为电阻R和C是串联函数，利用传递函数，求出噪声电压。为求全频率的噪声，对其积分，得到的输出端的总噪声和电阻无关，理由如下。

![image-20230619092439711](./assets/image-20230619092439711.png)

<img src="./assets/image-20230619092733824.png" alt="image-20230619092733824" style="zoom: 33%;" />

小电阻R=1ko，对应蓝色的曲线，噪声电压4ktR, 大电阻R=100k, 对应绿色的曲线。虽然R1<R2, 有v_1<V_2, 但是带宽w_1>w_2, 两个折中，在频率非常大的时候，总噪声是一样的。等价的带宽值如上推导，噪声电压应该等于总体的噪声。

<img src="./assets/image-20230619093835728.png" alt="image-20230619093835728" style="zoom: 33%;" />

从另外一个角度分析，为什么R和C串联，输出端的噪声和C是不相关的。电容上的能量E,V为压差。热噪声能量为KT。左电源，电阻，电容，为使得C的能量为1/2CV^2,该点的电压应该为V。为有电压V， 输入的能量应该有E=QV，Q为C上的电量。噪声电压是给电容充电的来源，两个应该相等，从而得到上面的结果。这也是为什么输出端的总噪声和电阻无关，和电容相关。之前的电容采集输入端的电压信号，现在用电感采集输入端的电流信号，因为开关，也会有噪声电流。

<img src="./assets/image-20230619101829386.png" alt="image-20230619101829386" style="zoom: 25%;" /><img src="./assets/image-20230619101938240.png" alt="image-20230619101938240" style="zoom:33%;" />

由前面电阻和C串联，对噪声来说等效的带宽如上。极点w_0的低通滤波器来说，等效噪声带宽是w_0/4。

<img src="./assets/image-20230619102642534.png" alt="image-20230619102642534" style="zoom: 33%;" />

第一步先画小信号图，受控电流源，电阻，电容，噪声源。噪声源包含电阻（4ktR_L）, 电容不考虑，mos管需要考虑，工作在饱和区。第二步，令输出端为0，电流源电流为0。

<img src="./assets/image-20230619103416080.png" alt="image-20230619103416080" style="zoom: 33%;" />

## 6.2

<img src="./assets/image-20230619103759444.png" alt="image-20230619103759444" style="zoom:33%;" />

信号的能量除以噪声的能量，由以前的电路的知识，正弦波和其等效的幅值，转为直流信号，1/sqrt(2)V_p, 信号的功率是平方的关系。

噪声的功率和kT/c有关，引入一个新的参数。整理得到如上公式。SNR变大4倍，C也变大4倍，SNR要增加6db,电容4倍，若要电路速度不变，即带宽不变gm/C，需要gm增加4倍，若要保持电路的vsta,电流4倍，总体功耗4倍。

<img src="./assets/image-20230619111233394.png" alt="image-20230619111233394" style="zoom: 50%;" />

数字电路增加1bit,电路精度变成原来的2倍。设置量化步长delat，若数字电路工程，增加6dp,N增加一倍，1bit。

<img src="./assets/image-20230619111758415.png" alt="image-20230619111758415" style="zoom:50%;" />

1bit, 4倍power，不要overdesign。

<img src="./assets/image-20230619111934574.png" alt="image-20230619111934574" style="zoom: 33%;" />

输入端的噪声电压和负载电容不相关，只和gm有关，gm一般固定的，故输入端的噪声电压一般是固定的。

<img src="./assets/image-20230619112119205.png" alt="image-20230619112119205" style="zoom: 33%;" />

有输入电压就有输入电流，如果输入端短路，输出端测得是噪声电压的影响，使得输入端开端，测得噪声电流，下同样。

<img src="./assets/image-20230619112937129.png" alt="image-20230619112937129" style="zoom:50%;" />

<img src="./assets/image-20230619113041911.png" alt="image-20230619113041911" style="zoom: 33%;" />

驱动源Vs总是有一定的内阻，Rs比较大，要求噪声电流小，若依然大，Rs上会有较大噪声电压。Rs比较小，要求噪声电压很小，因为若很大，Rs的压降不是很大，和运放串联，运放也有电阻，两侧噪声电压大。

<img src="./assets/image-20230619115001696.png" alt="image-20230619115001696" style="zoom: 25%;" /><img src="./assets/image-20230619115159972.png" alt="image-20230619115159972" style="zoom:25%;" />

Rs取什么值时，整体输出电压最小，当噪声电压除以噪声电流，开根号时，输出端噪声电压最小。

<img src="./assets/image-20230619115441151.png" alt="image-20230619115441151" style="zoom:50%;" />

上一张假设噪声电压和噪声电流是不想关的，实际两者相关，讲噪声电流分成相关和不想关部分。继续推导。

<img src="./assets/image-20230619115837881.png" alt="image-20230619115837881" style="zoom: 50%;" />

采样保持电路：

<img src="./assets/image-20230619120021752.png" alt="image-20230619120021752" style="zoom:50%;" />

## 7

上一讲主要讨论了电路里面的噪声和电阻没有关系，和电容有关 KT/C, 给了具体例子，计算输出端噪声，以两级运放方法器为例，先计算一级的，再计算二级输出端贡献，还探究了双端口电压例子，还探究了源极电阻在电器选择上的选择，如何选择源极电阻，使得双端口电压最小值。

<img src="./assets/image-20230619142616373.png" alt="image-20230619142616373" style="zoom:50%;" />

反馈电路中，由于反馈作用，输出信号会对输入信号进行补偿，从而减小输入信号的噪声。在反馈电路中，如果输出信号的SNR没有下降（信号/噪声），意味着反馈电路对于噪声的抑制结果很好，输出信号的质量得到了保证。噪声是电路不可避免的因素，反馈电路尽可能的抑制噪声，提高输出信号的质量。理想的反馈电路中，没有任何耗损，反馈信号完全能准确的反馈到输入端，实际的反馈电路，受到温度，电路元件内部阻抗，影响反馈电路的性能。

<img src="./assets/image-20230619144110252.png" alt="image-20230619144110252" style="zoom:50%;" />

右上，双端口网络可以分解成2个单端口网络，噪声电流可以表示为输入端口的短路噪声电流，反馈电阻的噪声电压可以表示为输出端口的开路噪声电压。

<img src="./assets/image-20230619144817673.png" alt="image-20230619144817673" style="zoom:50%;" />

更简单方法，反馈电阻对输入端的。与R_F, 并联电流源，输入端的电流信号，变成电压信号。为了衡量R_F对输入端的影响。噪声电流，一部分固有的，一部分由R_F引入。

<img src="./assets/image-20230619150235833.png" alt="image-20230619150235833" style="zoom:50%;" />

串联并联反馈，正方形是反馈，一个电压形输入，反馈电阻对输入端的影响关系。

<img src="./assets/image-20230619150510219.png" alt="image-20230619150510219" style="zoom:50%;" />

R_1和R_2要非常大，同向放大器。

<img src="./assets/image-20230619150638243.png" alt="image-20230619150638243" style="zoom:50%;" />
